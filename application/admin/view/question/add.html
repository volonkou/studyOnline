{layout name="public:layout"/}
<style>
    .question-type-pane {
        display: none;
    }
    .question-type-pane.active {
        display: block;
    }
    .question-option {
        font-size: 0;
        margin-bottom: 10px;
    }
    .question-option label,
    .question-option input[type=text] {
        font-size: 14px;
        vertical-align: middle;
    }
    .question-option input[type=text].form-control {
        display: inline-block;
        width: 400px;
    }
    .question-option label {
        margin-bottom: 0;
    }

    .question-wrapper .option li {
        margin-bottom: 10px;
    }

    .question-wrapper .question-score-wrapper input {
        height: 28px;
        width: 56px;
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 0;
        border: 1px solid #d8d8d8;
        border-radius: 4px;
        text-align: center;
        padding: 0;
        box-sizing: border-box;
    }
    .question-wrapper a {
        position: absolute;
        right: 15px;
        font-size: 12px;
        color: #b7b7b7;
        border: 1px solid #e0e2e3;
        border-radius: 4px;
        padding: 8px 16px;
        background: #fff;
        transition: all .3s;
    }
    .question-wrapper a:hover {
        color: #1a8cfe;
        border-color: #1a8cfe;
    }
    .question-wrapper a i {
        margin-right: 11px;
    }
</style>
<h4 class="text-center text-danger">新建题目</h4>
<div id="addQuestionWrapper" style="width: 750px; padding-top: 15px;">
    <form class="form-horizontal" id="addQuestionForm" data-id="{$question.id|default=''}">
        <div class="form-group">
            <label class="col-sm-3 control-label">试题题目 :</label>
            <div class="col-sm-9">
                <textarea class="form-control" id="questionTitle" placeholder="试题题目" rows="4" name="title">{$question.title|default=''}</textarea>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">题型 :</label>
            <div class="col-sm-9">
                <select id="question-type" class="question-type" name="type" style="width: 200px;" title="题型">
                    <option value="1">判断题</option>
                    <option value="2">单选题</option>
                    <option value="3">填空题</option>
                    <option value="4">简答题</option>
                </select>
            </div>
        </div>
        <div class="question-setting-wrapper">
            <div class="question-type-pane active" data-type="1">
                <div class="form-group">
                    <label class="col-sm-3 control-label">选项 :</label>
                    <div class="col-sm-9">
                        <div class="question-option">
                            <input type="radio" name="trueOrFalse" title="判断题选项">
                            <label class="trueOrFalse">正确</label>
                        </div>
                        <div class="question-option">
                            <input type="radio" name="trueOrFalse" title="判断题选项">
                            <label class="trueOrFalse">错误</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="question-type-pane" data-type="2">
                <div class="form-group">
                    <label class="col-sm-3 control-label">选项 :</label>
                    <div class="col-sm-9">
                        <div class="question-option">
                            <input type="radio" name="radio" title="单选题选项">
                            <input type="text" class="form-control" name="radioText" placeholder="单选题选项内容" value="" >
                        </div>
                        <div class="question-option">
                            <input type="radio" name="radio" title="单选题选项">
                            <input type="text" class="form-control" name="radioText" placeholder="单选题选项内容" value="">
                        </div>
                        <div class="question-option">
                            <input type="radio" name="radio" title="单选题选项">
                            <input type="text" class="form-control" name="radioText" placeholder="单选题选项内容" value="">
                        </div>
                        <div class="question-option">
                            <input type="radio" name="radio" title="单选题选项">
                            <input type="text" class="form-control" name="radioText" placeholder="单选题选项内容" value="">
                        </div>
                    </div>
                </div>
            </div>
            <div class="question-type-pane" data-type="3">
                <div class="form-group">
                    <label class="col-sm-3 control-label">答案 :</label>
                    <div class="col-sm-9">
                        <div class="question-option">
                            <input class="form-control" type="text" name="blank" title="填空内容">
                        </div>
                    </div>
                </div>
            </div>
            <div class="question-type-pane" data-type="4">
                <div class="form-group">
                    <label class="col-sm-3 control-label">关键字 :</label>
                    <div class="col-sm-9">
                        <div class="question-option">
                            <input class="form-control" type="text" name="keyword" title="关键字">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">重要关键字 :</label>
                    <div class="col-sm-9">
                        <div class="question-option">
                            <input class="form-control" type="text" name="keywordImp" title="重要关键字">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">试题解析 :</label>
            <div class="col-sm-9">
                <textarea class="form-control" name="analysis" id="analysis" rows="4" placeholder="试题解析"></textarea>
            </div>
        </div>
        <div class="form-group" style="text-align: right;">
            <a id="saveQuestion" class="btn btn-primary">保存</a>
        </div>
    </form>
</div>


<script>
    (function () {
        // 保存
        $('#saveQuestion').on('click', function () {
                let form = $('#addQuestionForm')
                let  formData = {}
                let type = $('.question-type-pane.active').data('type');
                let questionData = getQuestionData(type);
               let questionType= form.find('[name="type"]').val();
               let typeName;
                 switch (questionType) {
                     case "1":
                         typeName="判断题";
                         break;
                     case "2":
                         typeName="选择题";
                         break;
                     case "3":
                         typeName="填空题";
                         break;
                     case "4":
                         typeName="简答题";
                         break;
                 }

                formData["title"] = form.find('[name="title"]').val();
                formData["options"] = questionData.options|| "";
                formData["answer"] = questionData.answer||"";
                formData["keyword"] = questionData.keyword|| "";
                formData["keyword_imp"] = questionData.keyword_imp|| "";
                formData["type"] = questionType;
                formData["name"] = typeName;
                formData["analysis"] = form.find('[name="analysis"]').val();

            // console.log(formData)
                $.ajax({
                    url: "{:url('saveQuestion')}",
                    type: 'post',
                    data: formData,
                    success:function (data) {
                      alert(data.message)
                    }
                })

        });
        function getQuestionData(type) {
            var data = {}, options = [];
            switch (type) {
                case 1: // 判断题
                    $('[name=trueOrFalse]').each(function (index, item) {
                        if ($(item).is(':checked')) {
                            data.answer = index+1;
                        }
                    });
                    data.options = "正确||错误";
                    break;
                case 2: // 单选题
                    $('[name=radio]').each(function (index, item) {
                        options.push($.trim($(item).siblings('[name=radioText]').val()));
                        if ($(item).is(':checked')) {
                            data.answer = index+1;
                        }
                    });
                    data.options = options.join('||');
                    break;
                case 3: // 填空题
                    $('[name=blank]').each(function (index, item) {
                        options.push($.trim($(item).val()));
                    });
                    data.options = options.join('||');
                    data.answer = options.join('||');
                    break;
                case 4: // 简答题
                    data.keyword = $.trim($('[name=keyword]').val());
                    data.keyword_imp = $.trim($('[name=keywordImp]').val());
                    break;
            }
            return data;
        }
        // 选择题型
        $('.question-type').on('change', function () {
            var val = $(this).val();
            if (val !== null) {
                $('.question-setting-wrapper').find('.question-type-pane.active').removeClass('active');
                $('.question-setting-wrapper').find('.question-type-pane[data-type="' + val + '"]').addClass('active');
            }
        }).trigger('change');
    })();
</script>